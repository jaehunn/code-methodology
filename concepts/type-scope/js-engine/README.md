### 브라우저와 자바스크립트 엔진

1. Call Stack Execution
2. Message Queues and Event Loops
3. JavaScript Engine

---

자바스크립트 엔진(V8) 에는 두가지 요소가 있습니다.

1. 힙: 변수와 객체의 메모리 할당 영역
2. 콜 스택: 실행될 함수가 쌓이는 영역

콜 스택 예제

```jsx
function foo() {
  bar();
}

function bar() {}

foo();
```

1. foo 함수가 호출되면, 콜 스택에 foo 함수가 쌓입니다.
2. 더 이상 호출부가 없으니, 콜 스택에 있는 foo 함수가 실행됩니다.
3. foo 함수는 bar 함수를 호출하므로, 콜 스택에 bar 함수가 쌓입니다.
4. bar 함수는 아무일도 하지않고 종료되고, 콜 스택에서 빠져나갑니다.
5. foo 함수도 종료되고, 콜 스택에서 빠져나갑니다.

> 스택 오버 플로우: 재귀 함수를 사용해 함수 순환 구조가 만들어지면 콜 스택이 넘치게 된다.

자바스크립트 엔진은 하나의 콜 스택으로 단일 스레드 환경입니다.

단일 스레드(콜 스택 하나) 인 자바스크립트 엔진에서는 스레드(함수) 간 간섭이 일어나지 않습니다.

함수 내부의 코드는 원자적이라 함수 자체가 완전히 실행되는 형태입니다. 함수들의 순서, 공유하는 데이터만 조심하면, 결과의 비결정성 수준에는 문제가 없습니다.

> 단일 스레드 문제: 함수가 오랜시간 빠져나가지 못하면, 다음 함수가 오랜시간 지체된다.

자바스크립트 엔진은 단독으로 사용되지 않고, 호스팅(브라우저, 노드) 환경에서 실행됩니다.

자바스크립트 엔진은 하나의 함수를 하나씩 실행하는 실행기며, 브라우저의 이벤트 루프는 함수들을 적절히 스케줄링 합니다.

브라우저 동작 예제

```jsx
function foo() {
  setTimeout(() => {
    console.log("2초가 흘렀습니다!");
  }, 2000);
}

foo();
```

1. foo 함수가 콜 스택에 쌓이고, 더 이상 호출부가 없으니 foo 를 실행합니다.
2. foo 함수는 setTimeout 비동기 함수(호출되지만, 바로 끝낼 수 없는 함수) 를 호출하므로, 콜 스택에 setTimeout 함수가 쌓입니다.
3. setTimeout 함수가 실행되고, 콜백 함수(응답 처리 함수) 는 네트워크를 통해 응답을 리스닝합니다.
4. 2000ms 시간이 흐른 뒤, 응답을 콜백 함수가 받으면, 메세지 큐에 삽입됩니다. (응답을 기다리는 동안 다른 함수가 콜 스택에 적재되고 실행될 수 있습니다.)
5. 이때 이벤트 루프는 콜 스택이 완전히 비워졌는지를 확인하는 과정을 반복하고, 메세지 큐에 있는 콜백 함수를 콜 스택에 삽입합니다.
6. 콜 스택에서 콜백 함수가 실행됩니다. (console.log 함수의 과정은 생략했습니다.)
